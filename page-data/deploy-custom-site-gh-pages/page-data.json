{"componentChunkName":"component---src-templates-blog-post-js","path":"/deploy-custom-site-gh-pages/","result":{"data":{"site":{"siteMetadata":{"title":"Tech blog"}},"markdownRemark":{"id":"4dcf618c-39d7-5e0b-b5f4-c336895df84b","excerpt":"Hi, this is my first blog post, and I think it would be fitting to use this opportunity to document and explain how this site is setup as of today. Table ofâ€¦","html":"<p>Hi, this is my first blog post, and I think it would be fitting to use this opportunity to document and explain how this site is setup as of today.</p>\n<h1>Table of contents</h1>\n<ol>\n<li><a href=\"#GithubPages\">Github Pages</a></li>\n<li><a href=\"#GithubActions\">Github Actions</a></li>\n<li><a href=\"#CreateRepositories\">Create repositories</a></li>\n<li><a href=\"#CreateStaticSite\">Create static site</a></li>\n<li><a href=\"#SetupWorkflow\">Setup Github Workflow</a></li>\n</ol>\n<hr>\n<h2>Github Pages <a name=\"GithubPages\"></a></h2>\n<p><a href=\"https://pages.github.com/\">Github Pages</a> is a static site server available for free at your Github account. The site will serve all static files like: HTML, Javascript, CSS, etc. In order to use it you just need to create a repository called <code class=\"language-text\">&lt;username>.github.io</code> where <code class=\"language-text\">&lt;username></code> is your github username. In my case <code class=\"language-text\">kasperlauge.github.io</code>. Then just initialize the repository and push your static files to the main branch of the repository. The files will now be served at the URL <code class=\"language-text\">&lt;username>.github.io</code>.</p>\n<h2>Github Actions <a name=\"GithubActions\"></a></h2>\n<p><a href=\"https://github.com/features/actions\">Github Actions</a> is a feature providing the oppertunity to control your CI/CD use YAML files. If you are familiar with Pipelines in Azure DevOps, it is a similar feature, with some syntax differences. Github Actions can as in my case be used to trigger an action when a push to a repository occurs. This action could then be to build the source code of the repository and deploying the \"executable\" code to whereever.</p>\n<h2>Create repositories <a name=\"CreateRepositories\"></a></h2>\n<p>Alright, so in order to create a static site, we first need to create two repositories.</p>\n<p>The first repository is called <code class=\"language-text\">&lt;username>.github.io</code>. This is what is being served on <code class=\"language-text\">&lt;username>.github.io</code>. create the repository with the following settings (of course changing the username to your own):</p>\n<p><img src=\"./gh-pages-repo.png\" alt=\"Create Github Pages repository\"></p>\n<p>We initialize the repository with an empty readme so we don't have to do it manually. We will overwrite whats in the repository via a Github Workflow anyway.</p>\n<p>Next create the repository actually containing the code. You can use the following settings:\n<img src=\"./gh-pages-repo-code.png\" alt=\"Create Github Pages code repository\"></p>\n<p>I would like to keep the repository private. There is no reason to initialize this repository, as we need to add some code and can just do that from the command line.</p>\n<h2>Create a static site <a name=\"CreateStaticSite\"></a></h2>\n<p>In order to have something to show we need to create a site. This can be whatever static files you want to show. I chose to create a <a href=\"https://www.gatsbyjs.com/\">GatsbyJs</a> site using the blog template created by Kyle Mathews at GatsbyJS. This provides an out-of-the-box performant blog powered by markdown posts. A fast way to get started. As mentioned the site could be whatever as long as it is based of static files like HTML, Javascript, CSS, etc files. This could eg. be a SPA written in Angular or React, or also simply a plain index.html file.</p>\n<p>Using the GatsbyJS template I got roughly (I have removed the standard blog md files, and replaced with my own.) the following files:\n<img src=\"./static-site.png\" alt=\"Static site files\"></p>\n<p>Lets connect the code to our repository. Type the following in the terminal in the directory for the created code.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">git init\ngit add .\ngit commit -m \"First commit\"\ngit remote add origin https://github.com/kasperlauge/my-blog.git\ngit push -u origin main</code></pre></div>\n<p>* Replace repository in line 4 with your own</p>\n<p>Now we have a static site ready to be deployed.</p>\n<h2>Setup Github Workflow <a name=\"SetupWorkflow\"></a></h2>\n<p>In order to deploy to Github pages we could:</p>\n<ol>\n<li>Build our source files from <code class=\"language-text\">my-blog</code> locally</li>\n<li>Clone the <code class=\"language-text\">&lt;username>.github-io</code> repository</li>\n<li>Replace the files of said repository</li>\n<li>Commit and push to the main branch</li>\n</ol>\n<p>But that is a lot of manual steps to perform, which I would like to automate. This can be automated using a Github Action.</p>\n<p>You can create a Workflow using Github actions by navigating to your repository and click on the \"Actions\"-tab.</p>\n<p><img src=\"./gh-actions.png\" alt=\"Find Github Actions\"></p>\n<p>What this basically does, is creating a a YAML-file in a <code class=\"language-text\">.github/workflows</code> folder using some predefined templates. It is not necessary to create a workflow using the UI, but can be done using just code by creating said file in the same location.</p>\n<p>The actions we would need to do in a workflow file is similar to the manual steps described above, but with a few extra steps in order to have a full workflow:</p>\n<ol>\n<li>Clone the source files from <code class=\"language-text\">my-blog</code></li>\n<li>Build our source files from <code class=\"language-text\">my-blog</code></li>\n<li>Clone the <code class=\"language-text\">&lt;username>.github-io</code> repository</li>\n<li>Replace the files of said repository with the build files from <code class=\"language-text\">my-blog</code></li>\n<li>Commit and push to the main branch of the <code class=\"language-text\">&lt;username>.github-io</code></li>\n</ol>\n<p>In the end this results in the following file:</p>\n<p><code class=\"language-text\">.github/worksflow/build-and-deploy.yml</code></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># This is a basic workflow to help you get started with Actions\n\nname: Build and deploy to root pages\n\n# Controls when the workflow will run\non:\n  # Triggers the workflow on push events but only for the \"main\" branch\n  push:\n    branches: [\"main\"]\n\n  # Allows you to run this workflow manually from the Actions tab\n  workflow_dispatch:\n\n# A workflow run is made up of one or more jobs that can run sequentially or in parallel\njobs:\n  copy-files:\n    runs-on: ubuntu-latest\n    strategy:\n      matrix:\n        node-version: [18.x]\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v3\n        with:\n          node-version: ${{ matrix.node-version }}\n          path: \"src\"\n          ref: \"main\"\n          persist-credentials: false\n      - run: npm install --prefix src\n      - run: npm run build --prefix src\n      - name: Checkout\n        uses: actions/checkout@v3\n        with:\n          path: \"dest\"\n          ref: \"main\"\n          repository: \"kasperlauge/kasperlauge.github.io\"\n          token: ${{ secrets.BOT_TOKEN }}\n          fetch-depth: 0\n          persist-credentials: true\n      - name: Copy build files to kasperlauge.github.io\n        shell: bash\n        run: |\n          find dest -mindepth 1 -not -path 'dest/.git*' -delete\n          cp -r ./src/public/. ./dest/\n      - name: Check for new files\n        id: newFiles\n        shell: bash\n        working-directory: dest\n        run: |\n          git add -A\n          git status --porcelain | wc -l\n          if [[ $(git status --porcelain | wc -l) -gt 0 ]]; then\n            echo \"::set-output name=hasNewFiles::true\"\n          else\n            echo \"::set-output name=hasNewFiles::false\"\n          fi\n      - name: Push new files\n        if: ${{ steps.newFiles.outputs.hasNewFiles == 'true' }}\n        shell: bash\n        working-directory: dest\n        run: |\n          git config --global user.name \"Kasper [bot]\"\n          git config --global user.email \"${{ secrets.BOT_EMAIL }}\"\n          git commit -m \"maint: Updated build files\"\n          git push\n</code></pre></div>\n<p>The contents of above file can roughly be explained as follows:</p>\n<ol>\n<li>Trigger on push to <code class=\"language-text\">main</code> branch</li>\n<li>Use nodejs 18.x version</li>\n<li>Check out <code class=\"language-text\">my-blog</code> repository to <code class=\"language-text\">src</code>-folder</li>\n<li>Run <code class=\"language-text\">npm install</code></li>\n<li>Run <code class=\"language-text\">npm run build</code> (this is what builds the source code files into a <code class=\"language-text\">public</code>-folder)</li>\n<li>Check out <code class=\"language-text\">&lt;username>.github.io</code>-repository to <code class=\"language-text\">dest</code> folder</li>\n<li>Delete contents of <code class=\"language-text\">dest</code>-folder</li>\n<li>Copy contents of <code class=\"language-text\">src/public</code>-folder to <code class=\"language-text\">dest</code>-folder</li>\n<li>Check if any changes to the <code class=\"language-text\">dest</code>-folder</li>\n<li>If any changes to <code class=\"language-text\">dest</code>-folder push contents to <code class=\"language-text\">&lt;username>.github.io</code>-repository</li>\n</ol>\n<p>You might have noticed in above file that two secret variables are referenced:</p>\n<p><code class=\"language-text\">secrets.BOT_EMAIL</code> and <code class=\"language-text\">secrets.BOT_TOKEN</code>. These variables are setup in in the <code class=\"language-text\">Settings</code>-tab, as shown in below image:</p>\n<p><img src=\"./secret-setup.png\" alt=\"Secret setup\"></p>\n<p>The <code class=\"language-text\">BOT_EMAIL</code> can be whatever email. I used <code class=\"language-text\">kasperbot@kasperlauge.io</code>. This is just used for the commit made by the Github Workflow. The <code class=\"language-text\">BOT_TOKEN</code> should be a token with access to the <code class=\"language-text\">&lt;username>.github.io</code> repository. This is created by navigating to:\nAccount (by clicking you profile icon on the top right) > Settings > Developer Settings > Personal Access Tokens > Tokens (classic)\nThen press <code class=\"language-text\">Generate new token</code> (Choose classic).</p>\n<p>Generate the token with the following settings (The settings not shown is empty):</p>\n<p><img src=\"./token-settings.png\" alt=\"Token setup\"></p>\n<p>Copy the token and paste it in the secrets for the <code class=\"language-text\">my-blog</code> repository. Name it <code class=\"language-text\">BOT_TOKEN</code>.</p>\n<p>Now we should be ready to deploy. Make a small change to your <code class=\"language-text\">my-blog</code> repository. Commit and push that change, and see your Workflow in action.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f71c83d3ba8b7ac4e9c240606ee7d329/f025f/workflow-action.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.810126582278485%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3qEB/8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQABBQJ//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAFRABAQAAAAAAAAAAAAAAAAAAABH/2gAIAQEAAT8hiI//2gAMAwEAAgADAAAAEAPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGhAAAgIDAAAAAAAAAAAAAAAAAAERITFhcf/aAAgBAQABPxCqUZFocI//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Github Action\"\n        title=\"\"\n        src=\"/static/f71c83d3ba8b7ac4e9c240606ee7d329/828fb/workflow-action.jpg\"\n        srcset=\"/static/f71c83d3ba8b7ac4e9c240606ee7d329/ff44c/workflow-action.jpg 158w,\n/static/f71c83d3ba8b7ac4e9c240606ee7d329/a6688/workflow-action.jpg 315w,\n/static/f71c83d3ba8b7ac4e9c240606ee7d329/828fb/workflow-action.jpg 630w,\n/static/f71c83d3ba8b7ac4e9c240606ee7d329/0ede0/workflow-action.jpg 945w,\n/static/f71c83d3ba8b7ac4e9c240606ee7d329/3ac88/workflow-action.jpg 1260w,\n/static/f71c83d3ba8b7ac4e9c240606ee7d329/f025f/workflow-action.jpg 1676w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>And thats it! Now you should have a custom static static site running on Github Pages using a CI/CD flow. You can change your static site to what ever and after you push to your repository, it should be automatically deployed to Github Pages.</p>","frontmatter":{"title":"Deploy a custom static site to Github Pages using Github Actions","date":"July 08, 2023","description":"A blog post describing how to use the DevOps functionality in Github to deploy a static site to Github Pages"}},"previous":null,"next":null},"pageContext":{"id":"4dcf618c-39d7-5e0b-b5f4-c336895df84b","previousPostId":null,"nextPostId":null}},"staticQueryHashes":["2841359383","3274528899"],"slicesMap":{}}